<!doctype html>
<html>
  <head>
    <title>Memory Palace</title>
      <script src="https://webglfundamentals.org/webgl/resources/webgl-utils.js"></script>
<script src="https://webglfundamentals.org/webgl/resources/webgl-lessons-ui.js"></script>
<script src="https://webglfundamentals.org/webgl/resources/webgl-lessons-helper.js"></script>
    <script type="x-shader/x-vertex" id="vertex-shader">
    precision mediump float;
 
    attribute vec3 pos;
    attribute vec3 normal;
 
    varying vec3 col;
 
    uniform mat4 projectionMatrix, viewMatrix, modelMatrix;
    uniform mat3 normalMatrix;
 
    uniform vec3 ambientLightColour;
    uniform vec3 directionalLight;

    uniform vec3 spotCogitans;
    uniform float u_limit;
    uniform vec3 cog_color;

    uniform vec3 spotExtensa;
    uniform vec3 ext_color;

    uniform vec3 materialSpecular;
    uniform float materialAmbient, materialDiffuse, shininess;
 
    /* A function to determine the colour of a vertex, accounting
       for ambient and directional light */
    vec3 ads( vec4 position, vec3 norm )
    {
      vec3 s = normalize(vec3(vec4(directionalLight,1.0) - position));
      vec3 v = normalize(vec3(-position));
      vec3 r = reflect(-s, norm);

      vec3 cg = normalize(vec3(vec4(spotCogitans,1.0) - position));
      vec3 cr = reflect(-cg, norm);

      vec3 eg = normalize(vec3(vec4(spotExtensa,1.0) - position));
      vec3 er = reflect(-eg, norm);

      float cogitansLight = 0.0;
      float cogitansSpecular = 0.0;

      float extensaLight = 0.0;
      float extensaSpecular = 0.0;

      float dotFromDirectionCog = dot(cg,norm);

      float dotFromDirectionExt = dot(eg,norm);

      if(dotFromDirectionExt >= u_limit){
        extensaLight = dot(norm, eg);
        if(extensaLight>0.0){
          extensaSpecular = pow(dot(er,v), shininess);
        }
      }

      if(dotFromDirectionCog >= u_limit){
        cogitansLight = dot(norm, cg);
        if(cogitansLight>0.0){
          cogitansSpecular = pow(dot(cr,v), shininess);
        }
      }

      return ambientLightColour 
      + materialDiffuse * max(dot(s,norm), 0.0) 
      //+ materialDiffuse * max(cogitansLight, 0.0) 
      //+ materialSpecular * pow(max(dot(cr,v), 0.0), shininess)*cog_color
      + materialSpecular * cogitansSpecular*cog_color
      + materialSpecular * extensaSpecular*ext_color
       ;
    }
 
    void main() {
      vec3 eyeNormal = normalize(normal);
      vec4 eyePosition =  viewMatrix * modelMatrix * vec4(pos, 1.0);

      col = min(vec3(0.0) + ads(eyePosition, eyeNormal), 1.0);
      gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(pos, 1.0); 
    }
    </script>
    <script type="x-shader/x-fragment" id="fragment-shader">
    precision mediump float;
    varying vec3 normal;
    uniform mat4 projectionMatrix, viewMatrix, modelMatrix;
    
    varying vec3 col;
 
    void main() {
      vec3 v_normal = normalize(normal);

      gl_FragColor = vec4(col, 1.0);
    }
    </script>
    <script type="text/javascript" src="dist/jquery-2.1.1.js"></script>
    <script type="text/javascript" src="dist/gl-matrix.js"></script>
    <script type="text/javascript" src="memory.js"></script>

  </head>
  <body>
    <canvas id="rendering-surface" height="600" width="800"></canvas>
    <div id="uiContainer">
  <div id="ui">
    <div id="fRotation"></div>
    <div id="lightRotationX"></div>
    <div id="lightRotationY"></div>
    <div id="limit"></div>
  </div>
</div>
  </body>
</html>